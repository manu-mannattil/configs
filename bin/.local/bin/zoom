#!/bin/sh
#
# zoom - run zoom with proper HiDPI setting
#
# Note that the .desktop entry in
# /usr/share/applications might need to be edited to run
# this script instead of /usr/bin/zoom.
#

conf="$HOME/.config/zoomus.conf"

if [ "$conf" ]
then
    if [ "$GDK_SCALE" ]
    then
        echo >&2 "${0##*/}: using HiDPI resolution scale factor of $GDK_SCALE"
        sed -i "s/^scaleFactor.*/scaleFactor=$GDK_SCALE/" "$conf"
    else
        echo >&2 "${0##*/}: using resolution scale factor of 1"
        sed -i "s/^scaleFactor.*/scaleFactor=1/" "$conf"
    fi
fi

# Parse Zoom links and create zoommtg:// links.
case "$*" in
    http:*|https:*)
        set -- $(echo "$@" | sed 's|.*/j/\([0-9]*\).*pwd=\([a-zA-Z0-9]*\).*|\1 \2|')
        set -- --url="zoommtg://zoom.us/join?action=join&confno=$1&pwd=$2"
        ;;
esac

# Zoom writes logs to ~/.zoom/logs/zoom_stdout_stderr.log
exec /usr/bin/zoom "$@" >/dev/null 2>&1 &
